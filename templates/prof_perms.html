<!doctype html>
<html lang="en" data-framework="backbonejs">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>PERMinator</title>
		<link rel="stylesheet" href="/bower_components/todomvc-common/coursepage.css">
	</head>
	<body>
		<section id="todoapp">
			<header id="header">
				<h1>PERMs</h1>
			</header>
			<section id="main">
				<ul id="prof-perm-list"></ul>
			</section>
			<footer id="footer"></footer>
		</section>
		<footer id="info">
		</footer>
		<script type="text/template" id="prof-perm-template">
			<div>
				<% if(showBlurb) { %>
					<button class="hideBlurb" style="width:15px;padding:0px;">▼</button>
				<% } else { %>
					<button class="showBlurb" style="width:15px;padding:0px;">►</button>
				<% } %>
				<span style="width:15px"></span>
				<span>
					<div>
						<% if(status != "Revoked") { %>
							<center><i><%- status %></i></center>
						<% } %>
					</div>
					<div>
					<% if(status != "Denied" && status != "Revoked") { %>
						<input class="expdate" maxlength="10" size="10" value=<%- expirationTime %>>
					<% } %>
					<% if(status == "Revoked") { %>
						<% var future = new Date(); %>
						<% future.setDate(future.getDate() + 7); %>
						<% var dd = future.getDate(); %>
						<% var mm = future.getMonth()+1; %> <!--january is 0 -->
						<% var yyyy = future.getFullYear(); %>
						<span>
							<i><%- status %> 
								<% expParts = expirationTime.split("/") %>
								<% expDate = new Date(parseInt(expParts[2]), parseInt(expParts[0])-1, parseInt(expParts[1])) %>
								<% if (expDate < new Date()) { %>
									<%- expirationTime %>
									<input class="expdate" maxlength="10" size="10" value =<%- mm + "/" + dd + "/" + yyyy %>>
								<% } else { %>
									<input class="expdate" maxlength="10" size="10" value =<%- expirationTime %>>
								<% } %>
							</i>
						</span>
					<% } %>
					</div>
					<div id="statusButton">
						<% if (status == "Requested" || status == "Revoked" || status == "Denied") { %>
	    					<button class="statusAccept">Accept</button>
   	 						<% if(status == "Requested" || status == "Revoked") { %>
   	 							<button class="statusDeny">Deny</button>
    						<% } %>
						<% } %>
					</div>
				</span>
				<div id="info">
					<div id="name"><b><%- sFirstName + " " + sLastName %></b></div>	
					<div id="college"><i><%- college %></i></div>
					<div id="majors"><% majorSet = majors.split("MAJ_DIV") %>
						<span>
							<% for(maj in majorSet) { %>
								<div style="width:200px">
								<%- majorSet[maj] %>
								</div>
							<% } %>
						</span>
					</div>
					<% if(satisfiesMaj) { %>
						<%- "Satisfies" %>
					<% } else { %>
						<%- "Doesn't satisfy" %>
					<% } %>
				</div>
			<div id="error">
						<% if (errorMsg!=null) { %>
	    					<%-errorMsg%>
	    				<% } %>
					</div>
			<div>
				<% if(showBlurb) { %>
					<div>
						<span style="width:48px"></span><i><%- blurb %></i><p>
					</div>
					<% historySet = courseHistory.split("COURSE_DIV") %>
					<% for(histCourse in historySet) { %>
						<div>
								<span style="width:48px"></span><%- historySet[histCourse] %>
						</div>
					<% } %>
				<% } %>
			</div>
		</script>
		<script src="/bower_components/jquery/jquery.js"></script>
		<script src="/bower_components/underscore/underscore.js"></script>
		<script src="/bower_components/backbone/backbone.js"></script>
		<script src="/js/models/prof-perm.js"></script>
		<script src="/js/collections/prof-perms.js"></script>
		<script src="/js/collections/studentperms.js"></script>
		<script src="/js/collections/sections.js"></script>
		<script src="/js/views/prof-perm-view.js"></script>
		<script src="/js/views/perminator-app-view.js"></script>
		<script src="/js/routers/perminator-router.js"></script>
		<script src="/js/app.js"></script>
        <script>
        $(function(){
            app.prof_perms.reset({{ perms | tojson }});
            app.prof_perms.url = '{{ url_for("studentperm_create") }}';
        });
        </script>
	</body>
</html>
